
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Bart Lantz</title>
  <meta name="author" content="Bart Lantz">

  
  <meta name="description" content="This post continues my notes from Introduction to Databases, a MOOC taught by Stanford&#8217;s Jennifer Widom. The topic of this post is XQuery. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://bartlantz.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Bart Lantz" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Bart Lantz</a></h1>
  
    <h2>Math, Code and Science Fiction</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:bartlantz.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about/">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/05/xquery-notes/">XQuery Notes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-05T21:44:00-04:00" pubdate data-updated="true">May 5<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post continues my notes from <a href="https://class2go.stanford.edu/db/Winter2013">Introduction to Databases</a>, a MOOC taught by Stanford&#8217;s Jennifer Widom. The topic of this post is XQuery.</p>

<h2>XQuery Defition</h2>

<blockquote><p>XQuery is a query and functional programming language that is designed to query collections of XML data.</p><footer><strong>wikipedia</strong> <cite><a href='http://en.wikipedia.org/wiki/XQuery'>From Wikipedia</a></cite></footer></blockquote>


<h2>XQuery Syntax: FLWOR</h2>

<figure class='code'><figcaption><span>FLWOR Syntax</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xquery'><span class='line'><span class="k">for</span> <span class="nv">$var</span> <span class="ow">in</span> <span class="nt">expr</span>
</span><span class='line'><span class="k">let</span> <span class="nv">$var</span> <span class="o">:=</span> <span class="nt">expr</span>
</span><span class='line'><span class="k">where</span> <span class="nt">expr</span>
</span><span class='line'><span class="k">order by</span> <span class="nt">expr</span>
</span><span class='line'><span class="k">return</span> <span class="nt">expr</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/05/xpath-notes/">XPath Notes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-05T19:21:00-04:00" pubdate data-updated="true">May 5<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This spring I took <a href="https://class2go.stanford.edu/db/Winter2013">Introduction to Databases</a> a MOOC (Massive Open Online Class) from Stanford&#8217;s Jennifer Widom. It was very interesting, I learned a great deal from it. And one of the sections of the class that I really enjoyed, even though it sounded like it was going to be pretty dry, was the section on XML. I took quite a few pages of notes on the different XMl tools, so I figured I might as well post them to my blog.</p>

<h2>XPath Definition</h2>

<blockquote><p>XPath is a query language for selecting nodes from an XML document.</p></blockquote>

<p><a href="http://en.wikipedia.org/wiki/XPath">from Wikipedia</a></p>

<h3>XML for the Examples</h3>

<figure class='code'><figcaption><span>countries.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;countries&gt;</span>
</span><span class='line'>  <span class="nt">&lt;country</span> <span class="na">name=</span><span class="s">&quot;Afghanistan&quot;</span> <span class="na">population=</span><span class="s">&quot;22664136&quot;</span> <span class="na">area=</span><span class="s">&quot;647500&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;language</span> <span class="na">percentage=</span><span class="s">&quot;11&quot;</span><span class="nt">&gt;</span>Turkic<span class="nt">&lt;/language&gt;</span>
</span><span class='line'>    <span class="nt">&lt;language</span> <span class="na">percentage=</span><span class="s">&quot;35&quot;</span><span class="nt">&gt;</span>Pashtu<span class="nt">&lt;/language&gt;</span>
</span><span class='line'>    <span class="nt">&lt;language</span> <span class="na">percentage=</span><span class="s">&quot;50&quot;</span><span class="nt">&gt;</span>Afghan Persian<span class="nt">&lt;/language&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/country&gt;</span>
</span><span class='line'>  <span class="nt">&lt;country</span> <span class="na">name=</span><span class="s">&quot;Albania&quot;</span> <span class="na">population=</span><span class="s">&quot;3249136&quot;</span> <span class="na">area=</span><span class="s">&quot;28750&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;country</span> <span class="na">name=</span><span class="s">&quot;Algeria&quot;</span> <span class="na">population=</span><span class="s">&quot;29183032&quot;</span> <span class="na">area=</span><span class="s">&quot;2381740&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;city&gt;</span>
</span><span class='line'>      <span class="nt">&lt;name&gt;</span>Algiers<span class="nt">&lt;/name&gt;</span>
</span><span class='line'>      <span class="nt">&lt;population&gt;</span>1507241<span class="nt">&lt;/population&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/city&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/country&gt;</span>
</span><span class='line'><span class="nt">&lt;/countries&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Basic Path</h3>

<p>Selects all of countries from the country root node.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xquery'><span class='line'><span class="nf">doc</span><span class="p">(</span><span class="s1">&#39;countries.xml&#39;</span><span class="p">)/</span><span class="nt">countries</span><span class="p">/</span><span class="nt">country</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Path with Alternation</h3>

<p>This will select countries with populations that speak Pashtu or Swedish.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xquery'><span class='line'><span class="nf">doc</span><span class="p">(</span><span class="s1">&#39;countries.xml&#39;</span><span class="p">)/</span><span class="nt">countries</span><span class="p">/</span><span class="nt">country</span><span class="p">[</span><span class="nf">language</span><span class="p">(</span><span class="nt">Pashtu</span><span class="o">|</span><span class="nt">Swedish</span><span class="p">)]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Attributes are prepended with &#8220;@&#8221;</h3>

<p>This will select the names of all countries</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xquery'><span class='line'><span class="nf">doc</span><span class="p">(</span><span class="s1">&#39;countries.xml&#39;</span><span class="p">)/</span><span class="nt">countries</span><span class="p">/</span><span class="nt">country</span><span class="p">/</span><span class="na">@name</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Path with Conditional</h3>

<p>Select the names of all countries that have a population of less than 1,000,000.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xquery'><span class='line'><span class="nf">doc</span><span class="p">(</span><span class="s1">&#39;countries.xml&#39;</span><span class="p">)/</span><span class="nt">countries</span><span class="p">/</span><span class="nt">country</span><span class="p">[</span><span class="na">@population</span> <span class="nt">&lt;</span> <span class="err">1000000]/@</span><span class="nt">name</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Complex Conditional</h3>

<p>Select all countries that have a population of less than 1,000,000.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xquery'><span class='line'><span class="nf">doc</span><span class="p">(</span><span class="s1">&#39;countries.xml&#39;</span><span class="p">)/</span><span class="nt">countries</span><span class="p">/</span><span class="nt">country</span><span class="p">[</span><span class="na">@population</span> <span class="nt">&lt;</span> <span class="err">1000000</span> <span class="nt">and</span> <span class="nt">city</span><span class="err">/</span><span class="nt">population</span> <span class="nt">&gt;</span><span class="l"> 50000]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>data() prints out just the text value.</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xquery'><span class='line'><span class="nf">doc</span><span class="p">(</span><span class="s1">&#39;countries.xml&#39;</span><span class="p">)/</span><span class="nt">countries</span><span class="p">/</span><span class="nt">country</span><span class="p">[</span><span class="na">@population</span> <span class="nt">&lt;</span> <span class="err">1000000]/</span><span class="nt">data</span><span class="err">(@</span><span class="nt">name</span><span class="err">)</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/09/11/fun-with-grep-and/">Fun With Grep and Bash Aliases</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-11T00:00:00-04:00" pubdate data-updated="true">Sep 11<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Just a quick post to write up an bash alias I just created to list the sites enabled on a server and each sites location.</p>

<p>I often need to look up the list of sites enabled on a web server and also the document roots of each of these sites. In the past this meant loading the Apache configuration file into emacs or vim and searching for the site I was looking for.  Today I decided to create an alias for this task.  Here is the original combination of grep commands.</p>

<h2>Grep Command</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>grep <span class="s1">&#39;&#39;</span>^ServerName<span class="s2">&quot; -A 3 /etc/apache2/sites-available/default | \</span>
</span><span class='line'><span class="s2">   grep &quot;</span>^ServerName<span class="se">\|</span>^DocumentRoot<span class="se">\|</span>^--<span class="err">&quot;</span>
</span></code></pre></td></tr></table></div></figure>




<ol>
<li>^ServerName:
  <ul><li>Searches the file for all lines that begin with ServerName at the beginning of the line.</li></ul>
</li>
<li>-A 3
  <ul><li>Prints the 3 lines after the match.</li></ul>
</li>
<li>3. grep &#8220;^ServerName\|^DocumentRoot\|^&#8211;&#8221;&#8217; 
  <ul><li>Prints only the lines that we are interested (ie lines that begin with ServerName or DocumentRoot or &#8211;)</li>
  <li>The &#8220;\|&#8221; in the second grep command separates the regex with an &#8220;or&#8221; statement.  </li>
</li>
</ol>


<h2>Alias Command</h2>

<ol>
<li>Choose a name for the command, in my case, show-sites</li>
<li>Add the alias to the .bashrc or .bash_alias file in your home directory</li>
</ol>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">alias </span>show-sites<span class="o">=</span><span class="s1">&#39;grep &quot;^ServerName&quot; -A 3 /etc/apache2/sites-available/default | \</span>
</span><span class='line'><span class="s1"> grep &quot;^ServerName\|^DocumentRoot\|^--&quot;&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Reload Your Bash Configuration</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>. ~/.bashrc
</span></code></pre></td></tr></table></div></figure>


<h2>Show All Current Aliases</h2>

<p>Type alias at the command line to view all of the currently defined aliases.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">alias</span>
</span></code></pre></td></tr></table></div></figure>


<p>Bash prints out all of your aliases, like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">alias </span><span class="nv">ducks</span><span class="o">=</span><span class="s1">&#39;du -cks * |sort -rn |head -11&#39;</span>
</span><span class='line'><span class="nb">alias </span><span class="nv">gb</span><span class="o">=</span><span class="s1">&#39;git branch&#39;</span>
</span><span class='line'><span class="nb">alias </span><span class="nv">gba</span><span class="o">=</span><span class="s1">&#39;git branch -a&#39;</span>
</span><span class='line'><span class="nb">alias </span><span class="nv">gc</span><span class="o">=</span><span class="s1">&#39;git commit -v&#39;</span>
</span><span class='line'><span class="nb">alias </span><span class="nv">gca</span><span class="o">=</span><span class="s1">&#39;git commit -v -a&#39;</span>
</span><span class='line'><span class="nb">alias </span><span class="nv">gd</span><span class="o">=</span><span class="s1">&#39;git diff | vim -&#39;</span>
</span><span class='line'><span class="nb">alias </span><span class="nv">gl</span><span class="o">=</span><span class="s1">&#39;git log --stat&#39;</span>
</span><span class='line'><span class="nb">alias </span><span class="nv">gp</span><span class="o">=</span><span class="s1">&#39;git push&#39;</span>
</span><span class='line'><span class="nb">alias </span><span class="nv">graceful</span><span class="o">=</span><span class="s1">&#39;sudo apache2ctl graceful&#39;</span>
</span><span class='line'><span class="nb">alias </span><span class="nv">gst</span><span class="o">=</span><span class="s1">&#39;git status&#39;</span>
</span><span class='line'><span class="nb">alias </span><span class="nv">ls</span><span class="o">=</span><span class="s1">&#39;ls --color=auto&#39;</span>
</span><span class='line'><span class="nb">alias </span>show-sites<span class="o">=</span><span class="s1">&#39;grep &#39;</span><span class="se">\&#39;</span><span class="s1">&#39;^ServerName&#39;</span><span class="se">\&#39;</span><span class="s1">&#39; -A 3 /etc/apache2/sites-available/default \</span>
</span><span class='line'><span class="s1">  | grep &#39;</span><span class="se">\&#39;</span><span class="s1">&#39;^ServerName\|^DocumentRoot\|^--&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;&#39;</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/06/29/using-jquery-in-drupal/">Using jQuery in Drupal</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-29T18:52:00-04:00" pubdate data-updated="true">Jun 29<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Drupal 7 includes jQuery 1.4.4 by default.  So getting started using jQuery in your module or theme is really simple.  The easiest way to include a javascript file is to include it in a .info file with a line like &#8220;scripts[]= myfile.js&#8221;.</p>

<h2>How to include your js file in a module or theme</h2>

<h3>Add this to the .info file</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">scripts[] = js/myjavascript.js</span>
</span></code></pre></td></tr></table></div></figure>


<p>this will include the javascript file on every page that includes your module or theme.</p>

<h3>Include it in your Theme&#8217;s template.php</h3>

<p>Themes have more granular control of where javascript file is included in template.php</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">drupal_add_js(drupal_get_path(&#39;theme&#39;,&#39;kepler6_omega&#39;) . &#39;js/myjavascript.js&#39;);</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Use drupal_add_js in your module</h3>

<p>Include js in yarr.module</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">function yarr_form_alter(&amp;amp;$form, &amp;amp;$form_state, $form_id) {</span>
</span><span class='line'><span class="x">  drupal_add_js(drupal_get_path(&#39;module,&#39;yarr&#39;) . &#39;js/myjavascript.js&#39;);</span>
</span><span class='line'><span class="x">  ...</span>
</span><span class='line'><span class="x">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Use drupal_add_library to add libraries included in Drupal</h3>

<p>example add jQueryUI Accordion library</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">drupal_add_library(&#39;system&#39;,&#39;ui.accordion&#39;);</span>
</span></code></pre></td></tr></table></div></figure>


<p>While jQuery core is included by default, jQuery UI is not, so you need to include that with drupal_add_library if you need it, as above.)</p>

<h2>Drupal Behaviors</h2>

<h3>Drupal behaviors are used instead of $(document).ready();</h3>

<p>$(document).ready() is used to wait until the entire DOM is loaded before adding
your javascript functionality to the DOM.</p>

<p>Drupal adds its own way to add your javascript to the DOM</p>

<h3>Drupal attach behaviors</h3>

<p>attach your functionality to the Drupal objects behavior array</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Drupal</span><span class="p">.</span><span class="nx">behaviors</span><span class="p">.</span><span class="nx">yarr</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">attach</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">settings</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;h1 &amp;gt; a&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">h1text</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Yarrr, matey! &quot;</span> <span class="o">+</span> <span class="nx">h1text</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;h1:not(:has(a))&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">h1text</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Yarr, &quot;</span> <span class="o">+</span> <span class="nx">h1text</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="p">})(</span><span class="nx">jQuery</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Notes on the code example</h2>

<ul>
<li>The outside wrapper is required if you wish to use the short jquery &#8220;$&#8221; syntax.</li>
<li>$(&#8216;h1 &gt; a&#8217;) selects all of the H1 headers (and the inner anchor) that have immediate anchor children</li>
<li>$(&#8216;h1:not(:has(a))&#8217;) selects all H1 headers that do not have anchors embedded
in them.</li>
<li>.each, iterates over each element in the selector.</li>
</ul>


<p>Inside the function the &#8220;this&#8221; object refers to the current DOM element. If you want
the jQuery object use the $(this) syntax.</p>

<h2>Further Reading</h2>

<p> <a href="http://drupal.org/node/171213">Drupal Documentation on Javascript and jQuery</a></p>

<p> <a href="http://jquery.org">jQuery Documentation</a></p>

<p> <a href="http://api.jquery.org">jQuery API Documentation</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/22/drush-delete-comment/">Using Drush and SQL to Delete Spam Comments</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-22T00:00:00-04:00" pubdate data-updated="true">May 22<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>spam filters fall apart; the centre cannot hold.</p></blockquote>

<h3>Spam Gets By &#8230;</h3>

<p>From time to time, despite precautions, spammers get by the Drupal filters and
captchas.  Or perhaps, the problem gets put in your lap and you have
the pleasure of deleting thousands of spam comments.</p>

<p>The Drupal Administrative interface doesn&#8217;t provide many resources unless you enjoy clicking
&#8220;select all&#8221; and &#8220;delete selected comments&#8221;, page after page, 50 comments at a time.</p>

<h3>Drush to the Rescue</h3>

<p>But, if you are comfortable with sql, one easy solution is to use <strong>drush sql-query</strong>  to delete the comments.</p>

<h3>Before you start Deleting anything&#8230;</h3>

<p>If you are unfamiliar at all with sql, first back up your drupal database.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>drush sql-dump --result-file<span class="o">=</span>/path/to/dump-file.sql
</span></code></pre></td></tr></table></div></figure>


<p>You could also dump just the comment table. (The &#8216;~&#8217; says to save it
in your home directory.)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>drush sql-dump --result-file<span class="o">=</span>~/comment-table.sql --tables-list<span class="o">=</span>comment
</span></code></pre></td></tr></table></div></figure>


<h3>Now let&#8217;s get busy!</h3>

<h4>First take a look at the comment table:</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>drush sqlq <span class="s2">&quot;desc comment&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>( <strong>drush sqlq</strong> is the short form of <strong>drush sql-query</strong>)</p>

<p>You could also use drush sql-cli to view the comment table:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>drush sql-cli
</span><span class='line'>....
</span><span class='line'>mysql&gt; desc comment;
</span><span class='line'>+----------+---------------------+------+-----+---------+----------------+
</span><span class='line'>| Field    | Type                | Null | Key | Default | Extra          |
</span><span class='line'>+----------+---------------------+------+-----+---------+----------------+
</span><span class='line'>| cid      | int<span class="o">(</span>11<span class="o">)</span>             | NO   | PRI | NULL    | auto_increment |
</span><span class='line'>| pid      | int<span class="o">(</span>11<span class="o">)</span>             | NO   | MUL | 0       |                |
</span><span class='line'>| nid      | int<span class="o">(</span>11<span class="o">)</span>             | NO   | MUL | 0       |                |
</span><span class='line'>| uid      | int<span class="o">(</span>11<span class="o">)</span>             | NO   | MUL | 0       |                |
</span><span class='line'>| subject  | varchar<span class="o">(</span>64<span class="o">)</span>         | NO   |     |         |                |
</span><span class='line'>| hostname | varchar<span class="o">(</span>128<span class="o">)</span>        | NO   |     |         |                |
</span><span class='line'>| created  | int<span class="o">(</span>11<span class="o">)</span>             | NO   | MUL | 0       |                |
</span><span class='line'>| changed  | int<span class="o">(</span>11<span class="o">)</span>             | NO   |     | 0       |                |
</span><span class='line'>| status   | tinyint<span class="o">(</span>3<span class="o">)</span> unsigned | NO   |     | 1       |                |
</span><span class='line'>| thread   | varchar<span class="o">(</span>255<span class="o">)</span>        | NO   |     | NULL    |                |
</span><span class='line'>| name     | varchar<span class="o">(</span>60<span class="o">)</span>         | YES  |     | NULL    |                |
</span><span class='line'>| mail     | varchar<span class="o">(</span>64<span class="o">)</span>         | YES  |     | NULL    |                |
</span><span class='line'>| homepage | varchar<span class="o">(</span>255<span class="o">)</span>        | YES  |     | NULL    |                |
</span><span class='line'>| language | varchar<span class="o">(</span>12<span class="o">)</span>         | NO   |     |         |                |
</span><span class='line'>+----------+---------------------+------+-----+---------+----------------+
</span><span class='line'>14 rows in <span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Next take a look at the comments:</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>drush sqlq <span class="s2">&quot;select subject,cid from comment &quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>You can show comments from the last 30 days with the following.</h4>

<p>The created field is stored as a unix timestamp (seconds since the
Unix Epoch), so to get last month timestamp:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Seconds to <span class="nv">subtract</span> <span class="o">=</span> <span class="o">(</span>seconds in an hour<span class="o">)</span>*<span class="o">(</span>24 hours in a day<span class="o">)</span>*<span class="o">(</span>30 days<span class="o">)</span> <span class="o">=</span> 3600*24*30
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>drush sqlq <span class="s2">&quot;select subject,cid from comment where created &gt; unix_timestamp(now())-3600*24*30&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Delete comments within a range of comment ids.</h3>

<p>If you know the range of spam comment ids, you can give sql a range of comment ids:</p>

<p>Show the range of comments:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>drush sqlq <span class="s2">&quot;select subject,cid from comment where cid &gt; 3013 and cid &lt; 3134 &quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Delete the range of comments:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>drush sqlq <span class="s2">&quot;delete from comment where cid &gt; 3013 and cid &lt; 3134 &quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Show comments, group by name of commenter</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>drush sqlq <span class="s2">&quot;select subject,name,cid from comment where cid &gt; 300 group by name&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>But, honestly, there&#8217;s probably a drush delete-comments module that needs to be written!</h3>

<p>I&#8217;ll keep you posted of my progress on that. In the meantime, you can try using the previous commands.  Just remember to backup your database first, its only a single drush command after all!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>drush dump --result-file<span class="o">=</span>~/drupal-backup.sql
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/14/creating-a-better-print-screen/">Creating a Better Print Screen, Part I</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-14T00:00:00-04:00" pubdate data-updated="true">May 14<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>After reading Randall Degges excellent post <a href="http://rdegges.com/how-i-learned-to-program">How I learned to
Program</a>, I decided to
give creating a screenshot program a try. It&#8217;s always a bit of work to
take a screenshot, upload it to the web and then grab its permanent
link. So being a geek, I thought it high time this process was
automated!</p>

<p> I tried writing the program in python only, so that there were fewer
dependencies, but using the commandline program
<a href="https://en.wikipedia.org/wiki/Scrot">scrot</a> as the screenshot
snapping program added a lot of flexibility to the options for the
screenshot.</p>

<p>Without further ado, here are the parts of the program.</p>

<h2>Take Screenshot with scrot</h2>

<p>I start with a bash script that calls <a href="https://github.com/dreamer/scrot">scrot</a>, and passes in my program
as a parameter to scrot.</p>

<p>screen-upload.bash</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/bash
</span><span class='line'>/usr/local/bin/scrot '%m-%d-%Y-screenshot.png' -d 5 -u -e '/home/bart/projects/screen-upload/screen-upload.py $f' </span></code></pre></td></tr></table></div></figure>


<p>Next, chmod +x the bash script:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>chmod +x screen-upload.bash</span></code></pre></td></tr></table></div></figure>


<h3>Scrot Options explained</h3>

<ul>
<li><strong>-d 5</strong>: Delays the snap for 5 seconds.</li>
<li><strong>-u</strong>: Use the currently focused window.</li>
<li><strong>-e &#8216;script&#8217;</strong>: Execute the following script after the screenshot
is snapped.</li>
<li><strong>$f</strong>: passes in filename to script.</li>
</ul>


<h2>On to the Python Picture Uploading Program</h2>

<p>Scrot takes a screenshot after a delay of 5 seconds of the currently
active window, it names the file with the current
date-screenshot.png, it then passes the filename into my program,
&#8220;screen-upload.py&#8221;.</p>

<h2>Upload Image to Picasaweb</h2>

<p>For uploading the image to Picasaweb, I used the <a href="https://code.google.com/p/gdata-python-client/downloads/list">gdata
module</a>. Installing
it involved the standard: Download the module, extract it and cd into the
directory and  run &#8220;sudo python setup.py install&#8221;.</p>

<p>In version 2 of screen-upload, I will rewrite the authentication to use Oauth2, so that
the authentication is more secure, for the alpha version, I am just
passing in the users email and password into the <strong>gd_client</strong> object.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">gdata.photos.service</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">gdata.media</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">gdata.geo</span>
</span><span class='line'>
</span><span class='line'><span class="n">filename</span> <span class="o">=</span> <span class="n">fname</span>
</span><span class='line'><span class="n">gd_client</span> <span class="o">=</span> <span class="n">gdata</span><span class="o">.</span><span class="n">photos</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">PhotosService</span><span class="p">()</span>
</span><span class='line'><span class="n">gd_client</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">username</span>
</span><span class='line'><span class="n">gd_client</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">passwd</span>
</span><span class='line'><span class="n">gd_client</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="s">&#39;screen-upload-1&#39;</span>
</span><span class='line'><span class="n">gd_client</span><span class="o">.</span><span class="n">ProgrammaticLogin</span><span class="p">()</span>
</span><span class='line'><span class="k">print</span> <span class="s">&#39;uploading&#39;</span><span class="p">,</span>  <span class="n">filename</span>
</span><span class='line'>
</span><span class='line'><span class="n">album_url</span> <span class="o">=</span> <span class="s">&#39;/data/feed/api/user/</span><span class="si">%s</span><span class="s">/albumid/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">album_id</span><span class="p">)</span>
</span><span class='line'><span class="n">photo</span> <span class="o">=</span> <span class="n">gd_client</span><span class="o">.</span><span class="n">InsertPhotoSimple</span><span class="p">(</span><span class="n">album_url</span><span class="p">,</span> <span class="s">&#39;New Photo&#39;</span><span class="p">,</span>
</span><span class='line'>               <span class="s">&#39;Uploaded using the API&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&#39;image/png&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<h2>Copy URL into the Clipboard</h2>

<p>Copying the URL to the clipboard is easy as long as you are not too
concerned with cross-platform compatibility. I used the gtk module to
gain access to the clipboard on Linux systems.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">from</span> <span class="nn">gtk</span> <span class="kn">import</span> <span class="n">Clipboard</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">clip_store</span><span class="p">(</span><span class="n">pic_url</span><span class="p">):</span>
</span><span class='line'>    <span class="n">cb</span> <span class="o">=</span> <span class="n">Clipboard</span><span class="p">()</span>
</span><span class='line'>    <span class="n">cb</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">pic_url</span><span class="p">)</span>
</span><span class='line'>    <span class="n">cb</span><span class="o">.</span><span class="n">store</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>This can be made more cross-platform with a series of try statements
that load platform specific libraries.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">try</span><span class="p">:</span>
</span><span class='line'>  <span class="kn">import</span> <span class="nn">win32</span>
</span><span class='line'>
</span><span class='line'><span class="o">...</span>
</span><span class='line'><span class="k">try</span><span class="p">:</span>
</span><span class='line'>  <span class="kn">from</span> <span class="nn">gtk</span> <span class="kn">import</span> <span class="n">Clipboard</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Setting up the Keyboard Shortcut in Gnome 3.</h2>

<p>I had a bit of a bother creating a keyboard shortcut in Gnome.  I
created a new shortcut in the keyboard settings configuration, but
nothing happened.</p>

<p>Long story short: I created a shortcut under &#8220;Custom Shortcuts&#8221;.  I
called it &#8220;Take Screenshot&#8221; and I named the script &#8220;screen-upload&#8221;.
Then I created a symbolic link to the script in /usr/local/bin.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ln -s ~/projects/screen-upload/screen-upload.bash /usr/local/bin/screen-upload.
</span></code></pre></td></tr></table></div></figure>


<p>This did the trick, now when I press the PrtSc button, a screenshot is
taken of the current window, and its uploaded to Picasa and the URL of
the image is copied in to my clipboard!</p>

<p><img src="https://lh4.googleusercontent.com/-UNPsuNmMnTI/T7RlkQmmoyI/AAAAAAAACo8/O-vIjTeCtCE/s800/New%252520Photo.png" alt="&quot;Screenshot of screen-upload.py in Emacs&quot;" /></p>

<h2>References</h2>

<ul>
<li><a href="https://developers.google.com/picasa-web/docs/1.0/developers_guide_python">Picasa-web Python Developer&#8217;s Guide for API v1</a></li>
<li><a href="https://developers.google.com/gdata/docs/auth/overview">Google Data API Authentication Guide</a></li>
<li><a href="http://stackoverflow.com/questions/69645/take-a-screenshot-via-a-python-script-linux">Stackoverflow Answer for Taking Screenshot with python only</a></li>
<li><a href="http://rdegges.com/how-i-learned-to-program">Randall Degges: How I Learned to Program</a></li>
<li><a href="https://github.com/dreamer/scrot">Scrot&#8217;s Github Repository</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/05/11/jekyll-on-nfsn/">Using Jekyll on NearlyFreeSpeech.net</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-11T00:00:00-04:00" pubdate data-updated="true">May 11<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>NearlyFreeSpeech.net is a good simple, bare-bones fit for a Jekyll
site once everything is set up. The price can&#8217;t be beat, you can put
down a $10 payment and just try it out. With a Jekyll site, that $10
investment should last a while!</p>

<h2>Set Up SSH Alias</h2>

<p>The first thing to do is set up an ssh alias in your .bashrc file.
The hostname and username that are assigned at nfsn are generally
pretty easy to forget, so I always create an alias for them, like:</p>

<div>
  <pre><code class='bash'>alias sshnfsn='username_sitename@ssh.yourhostname.nearlyfreespeech.net';</code></pre>
</div>


<p>Once you save the .bashrc file, you can source it with:</p>

<div>
  <pre><code class='bash'>. ~/.bashrc</code></pre>
</div>


<p>and then test that it works with by running it.</p>

<div>
  <pre><code class='bash'>sshnfsn</code></pre>
</div>


<h2>Aside: Public, Private, Protected Directories</h2>

<p>On a nfsn site, there are 3 directories in your /home folder.</p>

<ul>
<li><p>The <strong>/home/public</strong> folder is your public facing directory. This is
your website&#8217;s public Document Root.</p></li>
<li><p>The <strong>/home/private</strong> folder is your private folder where you can store
git repos, your ruby gems, anything private you need to use or back
up.</p></li>
<li><p>The <strong>/home/protected</strong>: let me know if find a use for this.</p></li>
</ul>


<h2>Set Up Git on NFSN</h2>

<p>Once you are ssh&#8217;d into nfsn, cd into /home/private and create a
directory for your git repositories and create a bare git repository
for your site.</p>

<div>
  <pre><code class='bash'>cd /home/private
mkdir git
cd git
mkdir mysite.git
cd mysite.git
git init --bare</code></pre>
</div>


<p>Now you have a bare git repository for your jekyll site. The following
script will create a git post-receive hook, that will run every time
you push to your git repository.</p>

<div>
  <pre><code class='bash'>#!/bin/sh

REPONAME=mysite.git
GIT_REPO=$HOME/git/$REPONAME
TMP_GIT_CLONE=$HOME/git/tmp_deploy/$REPONAME
PUBLIC_WWW=/home/public

# clone the git repo into the tmp_deploy directory.
git clone $GIT_REPO $TMP_GIT_CLONE
# jekyll-ify the site and place html files in /home/public
jekyll --no-auto $TMP_GIT_CLONE $PUBLIC_WWW

rm -Rf $HOME/git/tmp_deploy/$REPONAME/.git/objects
rm -Rf $HOME/git/tmp_deploy/$REPONAME/.git
rm -Rf $HOME/git/tmp_deploy/$REPONAME

exit</code></pre>
</div>


<p>Be sure to chmod +x the file:</p>

<div>
  <pre><code class='bash'>chmod ug+x /home/private/git/mysite.git/post-receive</code></pre>
</div>


<p>Now, every time you &#8220;git push&#8221; into nfsn this post-receive hook will
auto-regenerate your jekyll site.</p>

<h2>Set Up a Git Remote to NFSN</h2>

<p>Back on your home computer or wherever you are building your jekyll
site, you need to create a git remote for your nsfn git
repository.</p>

<div>
  <pre><code class='bash'>cd ~/projects/mysite.git
# substitute in your username, sitename and nfsn hostname
git remote add nfsn ssh://&amp;lt;nsfnusername&amp;gt;-&amp;lt;sitename&amp;gt;@ssh.&amp;lt;hostname&amp;gt;.nearlyfreespeech.net/home/private/git/mysite.git</code></pre>
</div>


<p>Now that you have a git remote set up for your jekyll site, you can
Create a page in your jekyll &#8220;_post&#8221; directory. <br/>
Run &#8220;jekyll &#8211;server&#8221; to test it locally at http://localhost:4000.</p>

<div>
  <pre><code class='bash'>jekyll --server</code></pre>
</div>


<p>If it looks good, add it to your git repository.</p>

<div>
  <pre><code class='bash'>git commit -am &quot;new brilliant post!&quot;</code></pre>
</div>


<p>Next, push it to your website on nfsn.</p>

<div>
  <pre><code class='bash'>git push nfsn master</code></pre>
</div>


<p>The post-receive script you created earlier will generate your new public jekyll website automatically.</p>

<p>Test it and enjoy!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/14/sas-to-r/">SAS to R Notes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-14T00:00:00-04:00" pubdate data-updated="true">Apr 14<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="sec-1">How I did part of a SAS assignment in R</h2>
<div class="outline-text-2" id="text-1">
<p>
I was working on a SAS assignment for my Regression Analysis class.
The residual plot in SAS was corrupted, luckily I was able to recreate
it in R. (And actually it looks better in R too.)
</p>



<div>
  <pre><code class='r'># read in data from file 
gpa.data &lt;- read.table(&quot;GPA.txt&quot;);
# create multiple linear regression model
gpa.fit &lt;- lm(V4 ~ V1 + V2 + V3 + V5 + V6 + V7 + V8, data=gpa.data)

# save residuals to a variable
gpa.resid &lt;- residuals(gpa.fit)
# save Predicted values to a variable
gpa.yhat &lt;- fitted.values(gpa.fit)

# create png file, that plot will be saved to.
#png(&quot;resid.png&quot;)
# create a plot of residuals vs predicted values
plot(gpa.yhat,gpa.resid, ylab=&quot;Residuals&quot;, xlab=&quot;Predicted Values of Cum GPA&quot;, main=&quot;Plot of Residuals*Predicted Values&quot;)
# create a line#
abline(0,0)
# write plot to file
#dev.off()</code></pre>
</div>






<p>  
<img src="/assets/files/resid.png"  alt="resid.png" />
</p>

</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1">ANOVA table of the Multiple Regression Model</h3>
<div class="outline-text-3" id="text-1-1">



Here is R&#8217;s ANOVA command. Run it on the regression model gpa.fit.

<div>
  <pre><code class='r'>anova(gpa.fit)</code></pre>
</div>



Here is the output of the ANOVA command.

<div>
  <pre><code class='r'>Analysis of Variance Table

Response: V4
           Df  Sum Sq Mean Sq F value    Pr(&gt; F)    
V1          1   0.567  0.5669  1.8709  0.172001    
V2          1  26.488 26.4877 87.4135 &lt; 2.2e-16 ***
V3          1   9.096  9.0964 30.0194 6.839e-08 ***
V5          1   2.446  2.4459  8.0717  0.004683 ** 
V6          1   1.032  1.0324  3.4069  0.065524 .  
V7          1   0.020  0.0199  0.0655  0.798068    
V8          1   0.278  0.2784  0.9187  0.338288    
Residuals 492 149.084  0.3030                      
---
codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</code></pre>
</div>




</div>
The stars in R&#8217;s output are the signoificance code.  In the above
summary output, V2, V3, V5 are very significant. V1, V7, and V8 are
not very significant; the regression model should be tested without them.

</div>

<div id="outline-container-1-2" class="outline-3">
<h3 id="sec-1-2">Summary of Linear Regression Model</h3>
<div class="outline-text-3" id="text-1-2">




<div>
  <pre><code class='r'>summary(gpa.fit)</code></pre>
</div>





<div>
  <pre><code class='r'>Call:
lm(formula = V4 ~ V1 + V2 + V3 + V5 + V6 + V7 + V8, data = gpa.data)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.3345 -0.3387 -0.0059  0.3429  1.9661 

Coefficients:
              Estimate Std. Error t value Pr(&gt; |t|)    
(Intercept)  1.7792451  0.5165056   3.445  0.00062 ***
V1          -0.0383924  0.0527532  -0.728  0.46710    
V2           0.2716557  0.0417213   6.511 1.84e-10 ***
V3           0.0010404  0.0003173   3.279  0.00111 ** 
V5           0.0010332  0.0003425   3.016  0.00269 ** 
V6          -0.0391177  0.0239319  -1.635  0.10279    
V7          -0.0006554  0.0028471  -0.230  0.81805    
V8          -0.0054118  0.0056462  -0.958  0.33829    
---
codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1 

Residual standard error: 0.5505 on 492 degrees of freedom
Multiple R-squared: 0.2112, Adjusted R-squared:   0.2 
F-statistic: 18.82 on 7 and 492 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>



</div>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/12/vim-emacs-regex/">Vim Emacs Regex Smackdown</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-12T00:00:00-04:00" pubdate data-updated="true">Apr 12<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content">So, I was trying to convert an orgmode file to html. There is an orgmode-export-as-html function, but it was choking on something, so I needed to do the conversion by hand. I tried many, many times to convert the file with emacs regular expressions, but was unsuccessful.  The difficulty was the orgmode headlines, which look like this:

<div>
  <pre><code class='bash'>*** Use the sort function</code></pre>
</div>


I wanted to simply transform this into 
<div>
  <pre><code class='bash'>&lt;h3&amp;gt;Use the sort function&lt;/h3&amp;gt;</code></pre>
</div>


<h2>Vim Regexp</h2>
I was finally able to match the headline in vim with the following regular expression: 
<div>
  <pre><code class='bash'>\*\*\* \(\(w*\).*\)</code></pre>
</div>


<li> The literal asterisks had to be matched with \*.  
<li> Next, to match to the end of the line I used: \(\(w*\).*\) 
<li> \( \) creates a matching group, which can be used later in the replacement string with \1 or \2 etc.
<li> Also \(w*\).* matches 1 or more words

<h2>Vim Substitution Expression</h2>

<div>
  <pre><code class='bash'>%s/\*\*\* \(\(w*\).*\)/&lt;h3&amp;gt;\1&lt;\/h3&amp;gt;/</code></pre>
</div>

<li> The % matches the entire file
<li>The \1 matches the first matching group in the search string
That is, \1 will match everything on the line after the 3 literal asterisks.

<h2>Testing Matching String</h2>
Its easy to test a regular expression in vim.  While in command mode (hit Esc if you are in input mode), type a / and then type your regular expression and then press &#8220;return&#8221;, like so:
<div>
  <pre><code class='bash'>/\*\*\* [RETURN]</code></pre>
</div>


Your matches will be highlighted.  Click &#8216;n&#8217; to jump to the next match.

<h2>Getting back to previous substitution</h2>
Vim has a cool, intuitive way to explore your command history. In command mode, type &#8220;:&#8221; as for typing an ex command, and then press the up arrow to scroll up to through your command history. This is really handy for using previous, complex regular expressions.


</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/02/sas-notes/">Notes on SAS</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-02T00:00:00-04:00" pubdate data-updated="true">Apr 2<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>The Data Step</h2>
<h3>Subsetting IF</h3>
In a Data Step you can exclude some observations from the dataset with an if statement.
<div>
  <pre><code class='s'>data tornados_1980s;
  infile FileName;
  input year city damages;
  * this limits input data to 1980s data;
  if 1980 &lt;= year &lt;= 1989;
run;</code></pre>
</div>


<li> IF .. IN statement
<div>
  <pre><code class='s'>if year in (1980, 1981, 1982);</code></pre>
</div>


<li> AND, OR 
<div>
  <pre><code class='s'>if year = '1980' and city = 'Baltimore';</code></pre>
</div>
 


<h3>infile &#8216;filename&#8217;</h3>
In the data step, import data from a file with the infile command.
<div>
  <pre><code class='s'>data tornados;
  infile 'tornados.dat';
  input year city cost;
run;</code></pre>
</div>


<h3>Set </h3>
<li> Use the set command to create a new data set from an already created
  set.
The following creates a dataset of 1980s tornado data from the larger
set of tornado data.
<div>
  <pre><code class='s'>data tornados_1980s;
  set tornados;
  if 1980 &lt;= year &lt;= 1989;
run;</code></pre>
</div>


<h2>The PROC Step</h2>
<h3>PROC SORT</h3>
<li> The sort procedure, sorts data. You can sort by multiple fields.
<li> Also you can print by a field.
<div>
  <pre><code class='s'>proc sort data=tornados;
  by year city;
proc print data=tornados;
  by year;
run;</code></pre>
</div>


<h3>PROC Univariate</h3>
PROC Univariate generates descriptive statistics
<div>
  <pre><code class='s'>proc univariate data=tornados;
  histogram year;
run;</code></pre>
</div>


<h3>PROC means</h3>
Use proc means when you are only interested in basic descriptive statistics.
<h3>PROC freq</h3>
<li> generates tables for data in categories.
<h3>PROC gplot</h3>
<div>
  <pre><code class='s'>proc gplot data=tornados;
  plot year*cost;
  title 'Year by Cost tornados';
run;</code></pre>
</div>


<h3>PROC corr</h3>
<h4>compute the correlation</h4>
<div>
  <pre><code class='s'>proc corr data=grades;
  var exam1 exam2 hwscore;
run;</code></pre>
</div>


<h3>PROC reg</h3>
<li> p: prints obs, predicted, residuals
<li> r: same as p, plus more
<li> clm: 95% conf interval for mean of each obs
<li> cli: 95% prediction intervals.
<div>
  <pre><code class='s'>proc reg data=grades;
  model final=exam1 hwscore / p r cli clm;
  plot final*hwscore;
run;</code></pre>
</div>


<h2>Multiple Regression Analysis</h2>
<h3>Variable Selection</h3>
SAS has several methods for selecting variables

<div>
  <pre><code class='s'>proc reg data=cdi;
  model y = x1-x8 /selection=rsquare best=1;
  model y = x1-x8 /selection=adjrsq best=5;
  model y = x1-x8 /selection=cp best=10;
  model y = x1-x8 /selection=forward slentry=0.10;
  model y = x1-x8 /selection=stepwise slentry=0.10 slstay=0.10;
  model y = x1-x8 /selection=backward slstay=0.10;
run;</code></pre>
</div>


additional pages to try:
<a href=http://www.ats.ucla.edu/stat/sas/modules/graph.htm>more sas</a>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
<h1>About</h1>
<p>Major Ursa is a development blog written by Bart Lantz.</p>

<p>It focuses on Drupal, Ruby, Javascript, Vim, Git and Math, here and there.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/05/05/xquery-notes/">XQuery Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/05/xpath-notes/">XPath Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/11/fun-with-grep-and/">Fun with Grep and Bash Aliases</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/29/using-jquery-in-drupal/">Using jQuery in Drupal</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/22/drush-delete-comment/">Using Drush and SQL to Delete Spam Comments</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/underhilllabs">@underhilllabs</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'underhilllabs',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll&#8230;</ul>
  <p><a href="http://pinboard.in/u:seamusmcgraw">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "seamusmcgraw"; //id target for pinboard list
  var pinboard_count = 7; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>


<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/115249870106368908575?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Bart Lantz -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
