
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Setting Up a Web Enabled Lending Library - Bart Lantz</title>
  <meta name="author" content="Bart Lantz">

  
  <meta name="description" content="Setting Up a Web Enabled Lending Library <div id="outline-container-1.1" class="outline-3"> I started cataloging books for a small community center &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://bartlantz.com/blog/2010/07/29/up-home-setting-up-lending-library-with">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Bart Lantz" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Bart Lantz</a></h1>
  
    <h2>Math, Code and Science Fiction</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:bartlantz.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about/">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Setting Up a Web Enabled Lending Library</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-07-29T00:00:00-04:00" pubdate data-updated="true">Jul 29<span>th</span>, 2010</time>
        
      </p>
    
  </header>


<div class="entry-content"><div id="content"><div id="outline-container-1" class="outline-2">
<h3 id="sec-1">Setting Up a Web Enabled Lending Library </h3>





<div id="outline-container-1.1"
     class="outline-3"><div class="outline-text-3" id="text-1.1">


<p>
I started cataloging books for a small community center&#8217;s lending library at librarything.com.  Librarything.com is a
  great web site

that I highly recommend.  If most of your books have ISBNs and you can
borrow someone&#8217;s barcode scanner, cataloging books at Librarything is
a snap: on the &#8220;add books page&#8221; you scan a books ISBN and all of its
information (Title, Author, book cover) will be added by Librarything
for you.  Of course if you don&#8217;t have a bar code scanner or there is
no ISBN, you simply type in part of the title or author and select the
book from a list of possible matches, this is a bit slower, but
perfectly adequate if you are inputting a smaller library.  
</p><p>Once all of the books are added, the social networking goodness
begins!  You&#8217;re library has its own mini-site at Librarything, with a
publicly available catalog: <a href="http://librarything.com/catalog/buildupbooks">Build Up Books catalog</a> and profile:
<a href="http://librarything.com/profile/buildupbooks">Build Up Books profile</a>. So for a community center, you can send out the URL, and anyone can search the catalog for books they find of interest.  
</p><p>The one problem with this system, is there isn&#8217;t a robust system for
checking out books.  Some libraries have adapted an informal system of
tagging books as &#8220;checked out&#8221; and in the private comments (only
visible to the administrator) added the borrowers contact
information.  This is somewhat acceptable, but first: you would have
to give any volunteers access to all of your Librarything account&#8217;s
permissions (you get all or nothing as far admin rights goes on
Librarything).  Second there is no way to tell when the book was
checked out, when it is due back, and also no way to sort by which
books are currently overdue.  So I thought I would look into importing
the library, once cataloged, into a drupal web site.  
</p></div>
</div>
<div id="outline-container-1.2" class="outline-3"><h3 id="sec-1.2">Exporting Library from Librarything </h3><div class="outline-text-3" id="text-1.2">

<p>Librarything has excellent importing and exporting facilities.  To
export, sign in to your account and then go to
<a href="http://librarything.com/more/import">http://librarything.com/more/import</a>.  On that page there are links for
downloading your catalog as either a comma separated csv file or a tab
delimited text file. 
</p></div>
</div>
<div id="outline-container-1.3" class="outline-3"><h3 id="sec-1.3">Downloading User Uploaded Book Covers </h3><div class="outline-text-3" id="text-1.3">

<p>Librarything has over 1,000,000 user uploaded book covers, and it
makes them available for free.  You need to a developer&#8217;s key to
access them and there are some restrictions: you can only download
1000 per day and one per second. So with these understandable
restrictions, I decided it would be best to download the book covers
and store them locally.  So yesterday I wrote a python script to
download all of the book covers for our library.
</p></div>
</div>
<div id="outline-container-1.4" class="outline-3"><h3 id="sec-1.4">The Python Script </h3><div class="outline-text-3" id="text-1.4">

<p>I will add a link at the bottom to the script on my
<a href="http://github.com/underhilllabs">Github Repository</a>.  So the script I wrote searches through a
librarything csv file, finds all of the ISBNs and downloads the book
covers from <a href="http://librarything.com">Librarything</a>.  
</p>


<div>
  <pre><code class='python'>import re, urllib, csv,time

CSV_FILE ='~/Downloads/LibraryThing_export.csv'
IMG_DIR ='~/img/'
DEV_KEY = 'YOUR_LIBRARYTHING_DEV_KEY'
IMG_URL = &quot;http://covers.librarything.com/devkey/&quot; + DEV_KEY + &quot;/large/isbn/&quot;</code></pre>
</div>



<p>I use 4 python libraries.  
</p><ul>
  <li><b>Re</b>: for regular expressions to search for isbns.</li>
  <li><b>urllib</b>: for downloading the Book Cover from Librarything</li>
  <li><b>csv</b>: for creating a map data structure from a parsed csv file.</li>
  <li><b>time</b>: for limiting the downloads to one per second.</li>
</ul>
<p>Also I add a couple of variables.  The important one to change is
DEV_KEY which contains your librarything developers key.  Also make
sure the CSV_FILE points at your downloaded CSV_FILE and the IMG_DIR
exists.  Finally IMG_URL points to the web service on librarything
where you can download user submitted book covers, all you need to do
is slap an ISBN on the end of that URL and the URL will return either
a book cover, or a clear 1x1 gif if they do not have that cover.  
</p>


<div>
  <pre><code class='python'># read in the Librarything Export File
lt_dict = csv.DictReader(open(CSV_FILE))
#loop through the rows of the dictionary
for row in lt_dict:
    # grab the ISBN dictionary field
    mystr = row[&quot;'ISBN'&quot;]
    # search for a matching ISBN
    mymatch = re.match(r&quot;\[(\d+)\]&quot;,mystr)
    # if no match, print the title to STDOUT
    if mymatch is None:
        print &quot;blank isbn for: %s&quot; % row[&quot;'TITLE'&quot;]
    else:
        # grab the matching string, this is our ISBN!
        isbn = mymatch.group(1)
        # build the web service request URL
        myurl = IMG_URL + isbn
        # where we will store the downloaded Book cover image
        myfile = &quot;%slarge_%s&quot; % (IMG_DIR,isbn)
        # urlretrieve downloads the image and stores it locally
        urllib.urlretrieve(myurl,myfile)
        print &quot;myurl: %s, myfile: %s&quot; % (myurl,myfile)
        # sleep for 2 seconds
        time.sleep(2)</code></pre>
</div>




<p>The hard work is done by <a href="http://docs.python.org/library/csv.html#csv.DictReader">csv.DictReader</a> and <a href="http://docs.python.org/release/2.5.2/lib/module-urllib.html">urllib.urlretrieve</a>.
DictReader takes a csv file, parses the first line of the file for
field names and creates a dictionary data type, so you can loop
through the rows and have access to the fields by name.  Urlretrieve,
takes a URL and an optional file name and it grabs the file at the URL
and stores it locally as the filename you provided.  
</p><p>In a later blog post I will describe the Drupal end of this project:
creating a book CCK content type, importing data into Drupal custom
content types, and setting up the check out process.
</p></div></div></div></div><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/7035860407900002000-2092323799751063501?l=denverdroid.blogspot.com' alt='' /></div>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Bart Lantz</span></span>

      








  


<time datetime="2010-07-29T00:00:00-04:00" pubdate data-updated="true">Jul 29<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/python/'>Python</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://bartlantz.com/blog/2010/07/29/up-home-setting-up-lending-library-with/" data-via="bartofdenver" data-counturl="http://bartlantz.com/blog/2010/07/29/up-home-setting-up-lending-library-with/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2010/07/09/cool-things-to-do-emacs-dired/" title="Previous Post: Cool Things to Do in Emacs Dired Mode">&laquo; Cool Things to Do in Emacs Dired Mode</a>
      
      
        <a class="basic-alignment right" href="/blog/2010/12/21/using-gnu-screen_21/" title="Next Post: Using Gnu Screen">Using Gnu Screen &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
<h1>About</h1>
<p>Major Ursa is a development blog written by Bart Lantz.</p>

<p>It focuses on Drupal, Ruby, Javascript, Vim, Git and Math, here and there.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/05/05/xquery-notes/">XQuery Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/05/xpath-notes/">XPath Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/11/fun-with-grep-and/">Fun with Grep and Bash Aliases</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/29/using-jquery-in-drupal/">Using jQuery in Drupal</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/22/drush-delete-comment/">Using Drush and SQL to Delete Spam Comments</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/underhilllabs">@underhilllabs</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'underhilllabs',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>My Pinboard</h1>
  <ul id="pinboard_linkroll">Fetching linkroll...</ul>
  <p><a href="http://pinboard.in/u:seamusmcgraw">My Pinboard Bookmarks &raquo;</a></p>
</section>
<script type="text/javascript">
  var linkroll = 'pinboard_linkroll'; //id target for pinboard list
  var pinboard_user = "seamusmcgraw"; //id target for pinboard list
  var pinboard_count = 7; //id target for pinboard list
  (function(){
    var pinboardInit = document.createElement('script');
    pinboardInit.type = 'text/javascript';
    pinboardInit.async = true;
    pinboardInit.src = '/javascripts/pinboard.js';
    document.getElementsByTagName('head')[0].appendChild(pinboardInit);
  })();
</script>


<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/115249870106368908575?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Bart Lantz -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
